python -c "import akshare as ak; print(ak.stock_zh_a_hist_pre_min_em(symbol='600000', start_time='09:30:00', end_time='15:00:00'))"
                      时间     开盘     收盘     最高     最低   成交量        成交额     最新价
0    2025-03-26 09:30:00  10.60  10.60  10.60  10.60     0        0.0  10.600
1    2025-03-26 09:31:00  10.59  10.55  10.61  10.54  7862  8313291.0  10.576
2    2025-03-26 09:32:00  10.54  10.52  10.55  10.50  8531  8972718.0  10.547
3    2025-03-26 09:33:00  10.53  10.54  10.54  10.52  2487  2618514.0  10.544
4    2025-03-26 09:34:00  10.54  10.58  10.59  10.52  2640  2784264.0  10.545
..                   ...    ...    ...    ...    ...   ...        ...     ...
236  2025-03-26 14:56:00  10.47  10.47  10.47  10.46  2207  2309860.0  10.504
237  2025-03-26 14:57:00  10.47  10.47  10.47  10.46  2413  2525334.0  10.504
238  2025-03-26 14:58:00  10.47  10.47  10.47  10.47    48    50256.0  10.504
239  2025-03-26 14:59:00  10.47  10.47  10.47  10.47     0        0.0  10.504
240  2025-03-26 15:00:00  10.47  10.47  10.47  10.47  5319  5569444.0  10.503

[241 rows x 8 columns]
python -c "import akshare as ak; print(ak.stock_zh_a_hist_min_em(symbol='603860', period='5', start_date='20250326', end_date='20250326'))"
CREATE TABLE IF NOT EXISTS stock_codes (
        id SERIAL PRIMARY KEY,
        code VARCHAR(10) NOT NULL UNIQUE
		  );
		  

INSERT INTO stock_codes (code) VALUES
('002920'),('002600'),('002432'),('000429'),('000528'),('000426'),('000977'),('000729'),('000960'),('002517'),('000581'),
('002271'),('002423'),('000623'),('002508'),('000550'),('000423'),('002831'),('000902'),('002939'),('002558'),('002384'),
('000028'),('000887'),('002318'),('000685'),('002262'),('002850'),('002049'),('000544'),('002773'),('002756'),('000768'),
('000988'),('000951'),('002841'),('002056'),('002007'),('002572'),('000582'),('000537'),('000400'),('000034'),('002203'),
('002493'),('000739'),('000885'),('002273'),('002867'),('002668'),('002461'),('002705'),('002832'),('000422'),('000065'),
('002409'),('002472'),('000828'),('002158'),('002048'),('002821'),('002978'),('002430'),('000680'),('002152'),('002895'),
('002507'),('002539'),('002155'),('001203'),('000021'),('002541'),('002130'),('002468'),('002683'),('002011'),('000733'),
('000899'),('000155'),('000738'),('002557'),('002138'),('002372'),('002003'),('001914'),('002080'),('002126'),('000048'),
('002737'),('001301'),('000923'),('002020'),('002568'),('002053'),('002085'),('001308'),('002603'),('002156'),('002139'),
('000737'),('002818'),('002738'),('000403'),('000700'),('002625'),('000521'),('002332'),('002274'),('000612'),('002416'),
('002096'),
('002267'),
('001323'),
('000893'),
('002034'),
('002294'),
('000719'),
('002484'),
('002270'),
('002847'),
('001389'),
('002065'),
('002215'),
('002043'),
('000811'),
('002946'),
('000913'),
('002545'),
('002906'),
('002237'),
('002281'),
('002911'),
('002768'),
('002698'),
('002833'),
('002543'),
('002690'),
('002812'),
('000821'),
('002533'),
('002312'),
('002605'),
('002534'),
('001309'),
('000682'),
('000848'),
('002074'),
('002025'),
('002851'),
('002597'),
('002216'),
('002287'),
('001696'),
('000009'),
('002275'),
('002299'),
('002653'),
('002233'),
('003031'),
('000915'),
('000800'),
('002745'),
('002315'),
('002185'),
('002518'),
('002402'),
('000411'),
('002837'),
('000156'),
('000756'),
('002073'),
('001311'),
('002088'),
('000969'),
('002709'),
('002351'),
('002960'),
('002611'),
('002884'),
('002051'),
('002140'),
('002947'),
('002706'),
('002106'),
('002014'),
('002945'),
('002993'),
('003013'),
('002643'),
('002327'),
('002727'),
('002929'),
('002487'),
('002891'),
('002245'),
('002913'),
('002991'),
('002961'),
('002749'),
('002965'),
('002101'),
('002536'),
('000062'),
('000636'),
('002039'),
('002950'),
('002396'),
('002986'),
('002815'),
('002293'),
('002788'),
('002434'),
('002276'),
('002926'),
('002997'),
('000541'),
('002955'),
('000935'),
('002125'),
('002045'),
('002973'),
('000989'),
('002901'),
('003006'),
('002335'),
('000810'),
('002448'),
('002801'),
('002897'),
('002462'),
('002438'),
('002987'),
('002615'),
('000833'),
('000869'),
('002635'),
('000049'),
('002626'),
('001338'),
('003000'),
('002116'),
('002410'),
('000551'),
('002922'),
('002612'),
('002324'),
('001332'),
('002757'),
('000795'),
('000922'),
('000657'),
('003039'),
('002046'),
('002170'),
('001207'),
('002026'),
('000603'),
('002810'),
('000026'),
('001337'),
('000957'),
('000099'),
('002937'),
('002033'),
('002967'),
('002322'),
('002465'),
('002265'),
('002192'),
('002880'),
('002941'),
('000779'),
('002959'),
('002889'),
('002649'),
('003022'),
('002859'),
('000526'),
('002925'),
('002098'),
('002930'),
('002393'),
('001216'),
('002222'),
('002675'),
('002580'),
('002957'),
('001356'),
('001359'),
('003019'),
('002758'),
('003021'),
('002057'),
('002284'),
('000962'),
('002606'),
('002497'),
('002182'),
('001380'),
('002681'),
('003025'),
('002334'),
('002782'),
('000762'),
('000920'),
('002254'),
('001206'),
('001376'),
('001287'),
('002317'),
('002093'),
('002590'),
('000823'),
('002835'),
('002469'),
('002860'),
('000880'),
('002979'),
('002632'),
('002401'),
('002441'),
('002761'),
('000534'),
('002149'),
('003038'),
('002243'),
('001205'),
('002803'),
('002296'),
('000910'),
('003028'),
('002258'),
('002221'),
('002111'),
('002882'),
('002953'),
('001395'),
('002870'),
('000501'),
('000628'),
('000801'),
('001222'),
('003020'),
('002017'),
('002733'),
('001328'),
('002731'),
('003018'),
('002823'),
('000777'),
('000993'),
('001230'),
('002722'),
('002457'),
('002552'),
('001277'),
('002703'),
('002783'),
('002949'),
('002827'),
('002990'),
('002980'),
('002674'),
('002956'),
('000025'),
('002917'),
('002825'),
('002150'),
('002968'),
('002521'),
('003002'),
('001282'),
('002559'),
('002598'),
('002166'),
('002838'),
('002242'),
('003033'),
('002919'),
('001333'),
('001326'),
('001296'),
('002881'),
('001228'),
('001382'),
('002864'),
('002871'),
('002899'),
('002664'),
('001367'),
('001219'),
('001208'),
('002406'),
('002290'),
('001318'),
('002774'),
('000852'),
('001288'),
('001368'),
('002985'),
('001339'),
('002700'),
('000681'),
('001215'),
('002732'),
('002932'),
('003036'),
('000409'),
('001217'),
('002117'),
('001256'),
('002119'),
('000045'),
('002695'),
('002112'),
('001283'),
('001319'),
('001218'),
('002981'),
('002983'),
('002907'),
('002006'),
('000819'),
('001378'),
('001316'),
('003023'),
('002892'),
('001279'),
('002972'),
('001202'),
('002730'),
('000096'),
('002449'),
('002849'),
('003043'),
('002843'),
('002144'),
('001234'),
('002876'),
('002962'),
('001360'),
('001210'),
('001358'),
('002023'),
('002873'),
('002971'),
('002787'),
('002041'),
('002655'),
('001223'),
('003010'),
('001379'),
('002646'),
('002896'),
('000799'),
('000837'),
('003041'),
('003008'),
('000948'),
('002879'),
('002824'),
('001299'),
('001387'),
('002927'),
('002724'),
('001229'),
('000688'),
('002792'),
('003017'),
('002734'),
('001268'),
('002940'),
('001324'),
('001306'),
('000014'),
('002194'),
('002553'),
('002866'),
('002338'),
('001239'),
('002802'),
('002576'),
('001278'),
('000705'),
('002609'),
('002164'),
('002893'),
('001225'),
('002885'),
('002209'),
('002826'),
('001260'),
('002066'),
('002136'),
('000818'),
('002900'),
('002079'),
('002809'),
('002779'),
('002077'),
('000058'),
('002660'),
('001212'),
('002923'),
('002090'),
('000532'),
('001231'),
('002577'),
('002729'),
('002877'),
('002791'),
('002488'),
('001322'),
('002943'),
('001238'),
('000985'),
('002869'),
('002134'),
('001298'),
('002137'),
('001267'),
('002886'),
('002407'),
('003005'),
('000766'),
('002878'),
('001336'),
('001314'),
('000829'),
('003027'),
('002883'),
('002777'),
('002544'),
('003009'),
('002952'),
('001236'),
('002171'),
('002830'),
('002935'),
('002238'),
('000020'),
('002890'),
('002903'),
('002735'),
('001255'),
('001317'),
('000856'),
('001373'),
('001259'),
('002767'),
('002908'),
('002853'),
('002977'),
('002389'),
('002728'),
('000011'),
('003011'),
('601939'),
('601857'),
('601318'),
('600938'),
('600036'),
('600941'),
('601628'),
('601166'),
('600519'),
('601088'),
('601601'),
('601919'),
('600000'),
('600919'),
('600900'),
('601899'),
('601336'),
('601229'),
('600030'),
('601009'),
('601800'),
('601225'),
('601186'),
('600690'),
('601138'),
('601898'),
('600926'),
('601688'),
('600188'),
('600809'),
('600309'),
('600887'),
('601825'),
('601633'),
('601211'),
('601838'),
('601985'),
('603993'),
('600048'),
('600025'),
('600999'),
('601881'),
('600104'),
('600886'),
('603259'),
('601577'),
('600660'),
('600585'),
('600346'),
('600600'),
('600362'),
('600031'),
('603288'),
('600039'),
('600276'),
('600989'),
('600741'),
('600406'),
('601963'),
('600096'),
('600674'),
('600089'),
('601066'),
('600985'),
('600377'),
('601607'),
('601298'),
('601888'),
('601877'),
('600803'),
('600026'),
('600958'),
('600642'),
('603195'),
('601058'),
('600332'),
('603369'),
('601717'),
('600426'),
('603799'),
('600233'),
('601995'),
('601699'),
('601168'),
('605499'),
('600436'),
('600489'),
('600875'),
('600350'),
('600177'),
('600021'),
('601808'),
('600066'),
('603501'),
('600415'),
('600487'),
('600522'),
('600150'),
('605117'),
('601689'),
('601958'),
('601001'),
('603568'),
('600546'),
('601156'),
('600547'),
('600970'),
('600153'),
('603296'),
('601666'),
('603833'),
('600196'),
('603198'),
('600873'),
('601788'),
('600845'),
('600398'),
('600566'),
('600760'),
('601567'),
('601100'),
('600612'),
('600483'),
('600295'),
('601966'),
('600827'),
('600079'),
('603298'),
('603529'),
('605090'),
('600176'),
('600511'),
('603338'),
('601611'),
('601155'),
('603260'),
('601677'),
('600549'),
('600062'),
('600323'),
('600548'),
('600183'),
('603816'),
('600352'),
('600085'),
('600598'),
('601928'),
('600132'),
('600528'),
('600141'),
('603589'),
('600060'),
('601231'),
('601865'),
('600885'),
('601878'),
('603806'),
('600160'),
('603659'),
('603156'),
('600012'),
('600372'),
('600737'),
('600801'),
('600779'),
('603613'),
('600380'),
('603939'),
('603565'),
('600754'),
('600988'),
('600761'),
('601038'),
('601137'),
('603979'),
('603871'),
('603129'),
('600584'),
('600663'),
('600161'),
('603345'),
('600995'),
('600521'),
('600486'),
('603899'),
('600007'),
('600765'),
('601827'),
('601233'),
('600299'),
('600710'),
('603605'),
('600720'),
('601799'),
('601019'),
('601098'),
('603658'),
('600420'),
('600298'),
('600971'),
('601198'),
('600699'),
('603606'),
('600729'),
('600461'),
('600862'),
('603228'),
('603766'),
('600109'),
('601811'),
('601059'),
('601163'),
('603393'),
('603355'),
('601702'),
('603233'),
('600312'),
('600378'),
('600216'),
('603986'),
('603699'),
('603733'),
('601615'),
('600329'),
('600211'),
('603556'),
('600273'),
('603596'),
('600563'),
('603019'),
('601136'),
('600916'),
('600482'),
('600933'),
('600835'),
('600373'),
('600893'),
('600529'),
('601083'),
('603368'),
('600739'),
('600499'),
('601990'),
('600757'),
('603179'),
('600143'),
('601965'),
('600702'),
('603619'),
('601369'),
('603279'),
('601696'),
('603444'),
('603299'),
('603194'),
('601033'),
('600388'),
('600861'),
('600580'),
('600750'),
('603456'),
('603883'),
('600508'),
('603730'),
('603515'),
('603337'),
('603055'),
('600848'),
('600587'),
('603486'),
('601126'),
('603786'),
('600618'),
('603227'),
('603995'),
('600961'),
('605589'),
('605507'),
('603599'),
('600285'),
('601869'),
('600879'),
('603379'),
('603100'),
('600559'),
('605599'),
('600894'),
('600129'),
('600301'),
('603071'),
('600694'),
('601900'),
('603056'),
('600456'),
('600895'),
('603218'),
('601200'),
('600480'),
('600763'),
('603235'),
('603025'),
('603713'),
('601311'),
('603300'),
('603920'),
('600475'),
('601698'),
('603277'),
('603283'),
('600633'),
('603868'),
('600993'),
('603281'),
('601952'),
('605368'),
('603043'),
('600056'),
('600570'),
('600459'),
('603929'),
('603650'),
('603517'),
('605333'),
('600648'),
('603317'),
('603341'),
('600859'),
('603693'),
('603290'),
('600452'),
('603053'),
('600927'),
('600745'),
('603162'),
('603737'),
('605377'),
('600111'),
('601022'),
('601882'),
('601089'),
('600742'),
('603367'),
('603567'),
('603408'),
('601456'),
('605099'),
('600498'),
('600639'),
('600422'),
('603035'),
('605183'),
('603008'),
('603013'),
('600897'),
('600562'),
('603328'),
('603067'),
('600967'),
('603611'),
('603093'),
('600038'),
('600557'),
('601065'),
('603236'),
('603893'),
('603027'),
('603132'),
('603057'),
('600789'),
('600839'),
('603112'),
('600363'),
('603919'),
('605111'),
('603508'),
('605007'),
('603305'),
('600976'),
('603855'),
('603992'),
('603357'),
('603688'),
('600783'),
('603301'),
('600846'),
('600458'),
('600621'),
('600850'),
('605555'),
('600131'),
('603230'),
('605009'),
('603583'),
('603680'),
('603927'),
('601028'),
('603181'),
('605116'),
('603689'),
('603638'),
('603587'),
('605365'),
('603209'),
('605196'),
('600114'),
('603187'),
('603392'),
('603801'),
('603661'),
('603558'),
('600551'),
('603193'),
('603303'),
('603167'),
('603360'),
('603886'),
('603063'),
('605319'),
('603505'),
('603165'),
('603197'),
('600703'),
('605123'),
('603809'),
('603676'),
('600197'),
('600814'),
('603983'),
('605305'),
('603158'),
('601208'),
('603091'),
('603271'),
('605166'),
('603018'),
('603229'),
('603075'),
('603998'),
('603308'),
('603678'),
('603600'),
('603876'),
('600101'),
('605577'),
('605088'),
('605286'),
('600133'),
('603977'),
('601858'),
('603530'),
('603237'),
('605222'),
('603365'),
('603915'),
('603173'),
('603387'),
('605050'),
('603967'),
('605167'),
('603358'),
('603989'),
('605198'),
('605005'),
('603306'),
('603639'),
('605098'),
('605338'),
('603439'),
('603757'),
('601890'),
('603690'),
('603662'),
('603848'),
('601177'),
('603897'),
('603708'),
('600685'),
('605077'),
('603551'),
('603105'),
('603339'),
('603005'),
('603310'),
('605016'),
('605168'),
('603867'),
('603381'),
('603970'),
('603416'),
('603170'),
('600389'),
('600449'),
('603325'),
('605011'),
('603856'),
('600479'),
('600416'),
('603309'),
('603119'),
('603948'),
('603535'),
('600283'),
('605169'),
('603507'),
('600650'),
('603203'),
('605080'),
('600315'),
('603040'),
('603207'),
('603518'),
('603275'),
('601133'),
('600602'),
('600986'),
('605337'),
('603217'),
('600182'),
('603125'),
('603888'),
('603950'),
('601020'),
('603201'),
('603788'),
('603083'),
('603610'),
('605339'),
('603031'),
('603213'),
('600764'),
('603050'),
('603312'),
('600833'),
('605020'),
('605060'),
('603219'),
('603759'),
('603220'),
('603319'),
('603823'),
('603153'),
('603579'),
('603391'),
('603327'),
('605369'),
('603511'),
('603890'),
('603297'),
('603062'),
('603380'),
('605259'),
('603344'),
('600596'),
('603124'),
('603107'),
('600059'),
('603109'),
('600645'),
('603726'),
('605158'),
('600865'),
('603080'),
('600817'),
('603285'),
('603291'),
('603239'),
('603058'),
('603758'),
('603698'),
('603267'),
('603681'),
('603096'),
('605133'),
('605028'),
('603861'),
('603966'),
('603082'),
('603706'),
('603697'),
('601116'),
('603166'),
('601238'),
('603180'),
('603010'),
('603088'),
('603896'),
('603859'),
('600523'),
('603811'),
('605378'),
('603102'),
('600597'),
('603171'),
('600055'),
('605118'),
('603686'),
('600206'),
('603590'),
('603351'),
('601579'),
('603648'),
('603395'),
('600552'),
('603931'),
('605580'),
('603519'),
('600576'),
('603307'),
('600785'),
('605598'),
('605128'),
('600262'),
('603004'),
('603877'),
('603150'),
('603072'),
('603566'),
('603066'),
('600113'),
('603881'),
('603577'),
('603115'),
('605189'),
('600776'),
('605008'),
('603215'),
('605277'),
('603383'),
('605266'),
('605058'),
('603155'),
('603223'),
('600605'),
('603667'),
('603628'),
('603348'),
('605056'),
('605086'),
('603161'),
('603882'),
('603205'),
('600392'),
('600513'),
('603908'),
('603231'),
('603527'),
('605389'),
('603324'),
('603898'),
('605018'),
('605162'),
('603020'),
('600955'),
('603137'),
('605155'),
('603078'),
('603039'),
('603373'),
('600215'),
('603136'),
('603800'),
('600882'),
('603350'),
('603738'),
('603280'),
('603829'),
('605199'),
('603190'),
('603270'),
('605108'),
('603315'),
('603787'),
('605300'),
('603266'),
('603836'),
('600353'),
('600573'),
('600980'),
('603282'),
('603901'),
('605287'),
('603496'),
('603926'),
('603041'),
('603663'),
('603182'),
('603192'),
('603206'),
('603258'),
('603163'),
('603098'),
('603095'),
('603607'),
('603036'),
('605288'),
('603768'),
('600668'),
('603633'),
('605488'),
('603238'),
('600379'),
('603396'),
('603586'),
('605089'),
('605003'),
('603366'),
('603130'),
('603683'),
('603017'),
('603073'),
('603790'),
('603070'),
('603909'),
('603538'),
('603097'),
('600218'),
('603037'),
('600081'),
('603009'),
('603933'),
('603826'),
('603506'),
('600877'),
('603798'),
('600367'),
('600830'),
('603052'),
('603320'),
('603637'),
('603000'),
('603630'),
('603755'),
('603033'),
('603191'),
('600391'),
('600983'),
('603629'),
('603081'),
('605100'),
('603016'),
('603976'),
('600371'),
('603677'),
('600834'),
('603516'),
('603489'),
('603311'),
('605299'),
('603938'),
('603108'),
('605151'),
('603767'),
('600345'),
('603015'),
('603200'),
('603214'),
('603090'),
('603006'),
('603728'),
('605180'),
('603089'),
('605258'),
('605399'),
('600822'),
('605177'),
('603061'),
('603949'),
('605336'),
('603289'),
('605033'),
('603353'),
('603211'),
('603151'),
('603059'),
('603045'),
('603269'),
('603216'),
('603739'),
('603076'),
('603029'),
('601777'),
('600250'),
('603500'),
('600560'),
('603048'),
('603928'),
('600128'),
('605208'),
('603700'),
('603038'),
('600272'),
('603276'),
('605566'),
('603960'),
('603499'),
('603329'),
('605186'),
('605218'),
('600444'),
('603578'),
('600838'),
('600810'),
('603273'),
('603322'),
('605398'),
('600714'),
('600158'),
('600455'),
('600619'),
('600419'),
('603331'),
('603696'),
('600230'),
('603602'),
('603656'),
('603172'),
('603719'),
('603655'),
('603375'),
('605255'),
('603159'),
('603711'),
('605228'),
('600097'),
('603032'),
('600137'),
('603701'),
('600316'),
('603118'),
('603110'),
('605298'),
('600099'),
('603912'),
('605068'),
('605588'),
('600769'),
('603026'),
('603255'),
('603585'),
('603011'),
('600053'),
('603178'),
('603135'),
('603703'),
('603860'),
('603657'),
('600692'),
('603917'),
('600184');

10分钟内相等的
SELECT *
FROM (
    SELECT 
        *,
        LAG(latest_price) OVER (PARTITION BY code ORDER BY trade_time) AS prev_latest_price,
        LEAD(latest_price) OVER (PARTITION BY code ORDER BY trade_time) AS next_latest_price
    FROM stock_minute_data
    WHERE trade_time LIKE '2025-03-26 09:3%'
) AS subquery
WHERE latest_price = prev_latest_price AND latest_price = next_latest_price
ORDER BY code, latest_price DESC;

10分钟内连续3笔相等的
SELECT *
FROM (
    SELECT 
        *,
        LAG(low, 1) OVER (PARTITION BY code ORDER BY trade_time) AS prev1_latest_price,
        LAG(low, 2) OVER (PARTITION BY code ORDER BY trade_time) AS prev2_latest_price,
        LEAD(low, 1) OVER (PARTITION BY code ORDER BY trade_time) AS next1_latest_price,
        LEAD(low, 2) OVER (PARTITION BY code ORDER BY trade_time) AS next2_latest_price
    FROM stock_minute_data
    WHERE trade_time LIKE '2025-03-26 14:%5'
) AS subquery
WHERE 
    (low = prev1_latest_price AND latest_price = prev2_latest_price) OR
    (low = prev1_latest_price AND latest_price = next1_latest_price) OR
    (low = next1_latest_price AND latest_price = next2_latest_price)
ORDER BY code, low DESC;

---5分钟内
SELECT *
FROM (
    SELECT 
        *,
        LAG(latest_price, 1) OVER (PARTITION BY code ORDER BY trade_time) AS prev1_latest_price,
        LAG(latest_price, 2) OVER (PARTITION BY code ORDER BY trade_time) AS prev2_latest_price,
        LEAD(latest_price, 1) OVER (PARTITION BY code ORDER BY trade_time) AS next1_latest_price,
        LEAD(latest_price, 2) OVER (PARTITION BY code ORDER BY trade_time) AS next2_latest_price
    FROM stock_minute_data
    WHERE trade_time BETWEEN '2025-03-26 09:31:00' AND '2025-03-26 09:36:00'
) AS subquery
WHERE 
    (latest_price = prev1_latest_price AND latest_price = prev2_latest_price) OR
    (latest_price = prev1_latest_price AND latest_price = next1_latest_price) OR
    (latest_price = next1_latest_price AND latest_price = next2_latest_price)
ORDER BY code, latest_price DESC;

--代码为
SELECT DISTINCT A.CODE,A.latest_price FROM (
SELECT *
FROM (
    SELECT 
        *,
        LAG(latest_price, 1) OVER (PARTITION BY code ORDER BY trade_time) AS prev1_latest_price,
        LAG(latest_price, 2) OVER (PARTITION BY code ORDER BY trade_time) AS prev2_latest_price,
        LEAD(latest_price, 1) OVER (PARTITION BY code ORDER BY trade_time) AS next1_latest_price,
        LEAD(latest_price, 2) OVER (PARTITION BY code ORDER BY trade_time) AS next2_latest_price
    FROM stock_minute_data
    WHERE trade_time BETWEEN '2025-03-26 14:00:00' AND '2025-03-26 15:00:00'
) AS subquery
WHERE 
    (latest_price = prev1_latest_price AND latest_price = prev2_latest_price) OR
    (latest_price = prev1_latest_price AND latest_price = next1_latest_price) OR
    (latest_price = next1_latest_price AND latest_price = next2_latest_price)
ORDER BY code, latest_price DESC) A


---30分钟内3次以上低价相同
SELECT *
FROM (
    SELECT 
        s.*,
        (SELECT COUNT(*)
         FROM stock_minute_data s2
         WHERE s2.code = s.code
           AND s2.low = s.low
           AND s2.trade_time BETWEEN s.trade_time - INTERVAL 30 MINUTE AND s.trade_time) AS count_in_30_min
    FROM stock_minute_data s
    WHERE s.trade_time BETWEEN '2025-03-26 09:31:00' AND '2025-03-26 10:01:00'
) AS subquery
WHERE count_in_30_min >= 3
ORDER BY code, low DESC;
 
 
 ----20250401一个月内趋势
 SELECT code FROM stock_codes WHERE CODE NOT IN(
'002080',
'600668',
'000715',
'603811',
'002299',
'603815',
'603078',
'002267',
'001299',
'601330',
'600415',
'002863',
'002690',
'300749',
'603006',
'300650',
'603151',
'002206',
'600176',
'002420',
'605005',
'603062',
'002658',
'301395',
'300199',
'603075',
'301319',
'300156',
'300844',
'301277',
'300260',
'002900',
'002667',
'001212',
'600353',
'001332',
'000859',
'301092',
'300797',
'301118',
'002639',
'300834',
'603630',
'600746',
'605009',
'600644',
'300398',
'000963',
'002318',
'002838',
'600619',
'603125',
'300702',
'002967',
'000733',
'000045');

---
TRUNCATE TABLE stock_codes;
INSERT INTO stock_codes (code) VALUES
('002920'),
('002600'),
('002432'),
('000429'),
('000528'),
('000426'),
('000977'),
('000729'),
('000960'),
('002517'),
('000581'),
('002271'),
('002423'),
('000623'),
('002508'),
('000550'),
('000423'),
('002831'),
('000902'),
('002939'),
('002558'),
('002384'),
('000028'),
('000887'),
('000685'),
('002262'),
('002850'),
('002049'),
('000544'),
('002773'),
('002756'),
('000768'),
('000988'),
('000951'),
('002841'),
('002056'),
('002007'),
('002572'),
('000582'),
('000537'),
('000400'),
('000034'),
('002203'),
('002493'),
('000739'),
('000885'),
('002273'),
('002867'),
('002668'),
('002461'),
('002705'),
('002832'),
('000422'),
('000065'),
('002409'),
('002472'),
('000828'),
('002158'),
('002048'),
('002821'),
('002978'),
('002430'),
('000680'),
('002152'),
('002895'),
('002507'),
('002539'),
('002155'),
('001203'),
('000021'),
('002541'),
('002130'),
('002468'),
('002683'),
('002011'),
('000899'),
('000155'),
('000738'),
('002557'),
('002138'),
('002372'),
('002003'),
('001914'),
('002126'),
('000048'),
('002737'),
('001301'),
('000923'),
('002020'),
('002568'),
('002053'),
('002085'),
('001308'),
('002603'),
('002156'),
('002139'),
('000737'),
('002818'),
('002738'),
('000403'),
('000700'),
('002625'),
('000521'),
('002332'),
('002274'),
('000612'),
('002416'),
('002096'),
('001323'),
('000893'),
('002034'),
('002294'),
('000719'),
('002484'),
('002270'),
('002847'),
('001389'),
('002065'),
('002215'),
('002043'),
('000811'),
('002946'),
('000913'),
('002545'),
('002906'),
('002237'),
('002281'),
('002911'),
('002768'),
('002698'),
('002833'),
('002543'),
('002812'),
('000821'),
('002533'),
('002312'),
('002605'),
('002534'),
('001309'),
('000682'),
('000848'),
('002074'),
('002025'),
('002851'),
('002597'),
('002216'),
('002287'),
('001696'),
('000009'),
('002275'),
('002653'),
('002233'),
('003031'),
('000915'),
('000800'),
('002745'),
('002315'),
('002185'),
('002518'),
('002402'),
('000411'),
('002837'),
('000156'),
('000756'),
('002073'),
('001311'),
('002088'),
('000969'),
('002709'),
('002351'),
('002960'),
('002611'),
('002884'),
('002051'),
('002140'),
('002947'),
('002706'),
('002106'),
('002014'),
('002945'),
('002993'),
('003013'),
('002643'),
('002327'),
('002727'),
('002929'),
('002487'),
('002891'),
('002245'),
('002913'),
('002991'),
('002961'),
('002749'),
('002965'),
('002101'),
('002536'),
('000062'),
('000636'),
('002039'),
('002950'),
('002396'),
('002986'),
('002815'),
('002293'),
('002788'),
('002434'),
('002276'),
('002926'),
('002997'),
('000541'),
('002955'),
('000935'),
('002125'),
('002045'),
('002973'),
('000989'),
('002901'),
('003006'),
('002335'),
('000810'),
('002448'),
('002801'),
('002897'),
('002462'),
('002438'),
('002987'),
('002615'),
('000833'),
('000869'),
('002635'),
('000049'),
('002626'),
('001338'),
('003000'),
('002116'),
('002410'),
('000551'),
('002922'),
('002612'),
('002324'),
('002757'),
('000795'),
('000922'),
('000657'),
('003039'),
('002046'),
('002170'),
('001207'),
('002026'),
('000603'),
('002810'),
('000026'),
('001337'),
('000957'),
('000099'),
('002937'),
('002033'),
('002322'),
('002465'),
('002265'),
('002192'),
('002880'),
('002941'),
('000779'),
('002959'),
('002889'),
('002649'),
('003022'),
('002859'),
('000526'),
('002925'),
('002098'),
('002930'),
('002393'),
('001216'),
('002222'),
('002675'),
('002580'),
('002957'),
('001356'),
('001359'),
('003019'),
('002758'),
('003021'),
('002057'),
('002284'),
('000962'),
('002606'),
('002497'),
('002182'),
('001380'),
('002681'),
('003025'),
('002334'),
('002782'),
('000762'),
('000920'),
('002254'),
('001206'),
('001376'),
('001287'),
('002317'),
('002093'),
('002590'),
('000823'),
('002835'),
('002469'),
('002860'),
('000880'),
('002979'),
('002632'),
('002401'),
('002441'),
('002761'),
('000534'),
('002149'),
('003038'),
('002243'),
('001205'),
('002803'),
('002296'),
('000910'),
('003028'),
('002258'),
('002221'),
('002111'),
('002882'),
('002953'),
('001395'),
('002870'),
('000501'),
('000628'),
('000801'),
('001222'),
('003020'),
('002017'),
('002733'),
('001328'),
('002731'),
('003018'),
('002823'),
('000777'),
('000993'),
('001230'),
('002722'),
('002457'),
('002552'),
('001277'),
('002703'),
('002783'),
('002949'),
('002827'),
('002990'),
('002980'),
('002674'),
('002956'),
('000025'),
('002917'),
('002825'),
('002150'),
('002968'),
('002521'),
('003002'),
('001282'),
('002559'),
('002598'),
('002166'),
('002242'),
('003033'),
('002919'),
('001333'),
('001326'),
('001296'),
('002881'),
('001228'),
('001382'),
('002864'),
('002871'),
('002899'),
('002664'),
('001367'),
('001219'),
('001208'),
('002406'),
('002290'),
('001318'),
('002774'),
('000852'),
('001288'),
('001368'),
('002985'),
('001339'),
('002700'),
('000681'),
('001215'),
('002732'),
('002932'),
('003036'),
('000409'),
('001217'),
('002117'),
('001256'),
('002119'),
('002695'),
('002112'),
('001283'),
('001319'),
('001218'),
('002981'),
('002983'),
('002907'),
('002006'),
('000819'),
('001378'),
('001316'),
('003023'),
('002892'),
('001279'),
('002972'),
('001202'),
('002730'),
('000096'),
('002449'),
('002849'),
('003043'),
('002843'),
('002144'),
('001234'),
('002876'),
('002962'),
('001360'),
('001210'),
('001358'),
('002023'),
('002873'),
('002971'),
('002787'),
('002041'),
('002655'),
('001223'),
('003010'),
('001379'),
('002646'),
('002896'),
('000799'),
('000837'),
('003041'),
('003008'),
('000948'),
('002879'),
('002824'),
('001387'),
('002927'),
('002724'),
('001229'),
('000688'),
('002792'),
('003017'),
('002734'),
('001268'),
('002940'),
('001324'),
('001306'),
('000014'),
('002194'),
('002553'),
('002866'),
('002338'),
('001239'),
('002802'),
('002576'),
('001278'),
('000705'),
('002609'),
('002164'),
('002893'),
('001225'),
('002885'),
('002209'),
('002826'),
('001260'),
('002066'),
('002136'),
('000818'),
('002079'),
('002809'),
('002779'),
('002077'),
('000058'),
('002660'),
('002923'),
('002090'),
('000532'),
('001231'),
('002577'),
('002729'),
('002877'),
('002791'),
('002488'),
('001322'),
('002943'),
('001238'),
('000985'),
('002869'),
('002134'),
('001298'),
('002137'),
('001267'),
('002886'),
('002407'),
('003005'),
('000766'),
('002878'),
('001336'),
('001314'),
('000829'),
('003027'),
('002883'),
('002777'),
('002544'),
('003009'),
('002952'),
('001236'),
('002171'),
('002830'),
('002935'),
('002238'),
('000020'),
('002890'),
('002903'),
('002735'),
('001255'),
('001317'),
('000856'),
('001373'),
('001259'),
('002767'),
('002908'),
('002853'),
('002977'),
('002389'),
('002728'),
('000011'),
('003011'),
('601939'),
('601857'),
('601318'),
('600938'),
('600036'),
('600941'),
('601628'),
('601166'),
('600519'),
('601088'),
('601601'),
('601919'),
('600000'),
('600919'),
('600900'),
('601899'),
('601336'),
('601229'),
('600030'),
('601009'),
('601800'),
('601225'),
('601186'),
('600690'),
('601138'),
('601898'),
('600926'),
('601688'),
('600188'),
('600809'),
('600309'),
('600887'),
('601825'),
('601633'),
('601211'),
('601838'),
('601985'),
('603993'),
('600048'),
('600025'),
('600999'),
('601881'),
('600104'),
('600886'),
('603259'),
('601577'),
('600660'),
('600585'),
('600346'),
('600600'),
('600362'),
('600031'),
('603288'),
('600039'),
('600276'),
('600989'),
('600741'),
('600406'),
('601963'),
('600096'),
('600674'),
('600089'),
('601066'),
('600985'),
('600377'),
('601607'),
('601298'),
('601888'),
('601877'),
('600803'),
('600026'),
('600958'),
('600642'),
('603195'),
('601058'),
('600332'),
('603369'),
('601717'),
('600426'),
('603799'),
('600233'),
('601995'),
('601699'),
('601168'),
('605499'),
('600436'),
('600489'),
('600875'),
('600350'),
('600177'),
('600021'),
('601808'),
('600066'),
('603501'),
('600487'),
('600522'),
('600150'),
('605117'),
('601689'),
('601958'),
('601001'),
('603568'),
('600546'),
('601156'),
('600547'),
('600970'),
('600153'),
('603296'),
('601666'),
('603833'),
('600196'),
('603198'),
('600873'),
('601788'),
('600845'),
('600398'),
('600566'),
('600760'),
('601567'),
('601100'),
('600612'),
('600483'),
('600295'),
('601966'),
('600827'),
('600079'),
('603298'),
('603529'),
('605090'),
('600511'),
('603338'),
('601611'),
('601155'),
('603260'),
('601677'),
('600549'),
('600062'),
('600323'),
('600548'),
('600183'),
('603816'),
('600352'),
('600085'),
('600598'),
('601928'),
('600132'),
('600528'),
('600141'),
('603589'),
('600060'),
('601231'),
('601865'),
('600885'),
('601878'),
('603806'),
('600160'),
('603659'),
('603156'),
('600012'),
('600372'),
('600737'),
('600801'),
('600779'),
('603613'),
('600380'),
('603939'),
('603565'),
('600754'),
('600988'),
('600761'),
('601038'),
('601137'),
('603979'),
('603871'),
('603129'),
('600584'),
('600663'),
('600161'),
('603345'),
('600995'),
('600521'),
('600486'),
('603899'),
('600007'),
('600765'),
('601827'),
('601233'),
('600299'),
('600710'),
('603605'),
('600720'),
('601799'),
('601019'),
('601098'),
('603658'),
('600420'),
('600298'),
('600971'),
('601198'),
('600699'),
('603606'),
('600729'),
('600461'),
('600862'),
('603228'),
('603766'),
('600109'),
('601811'),
('601059'),
('601163'),
('603393'),
('603355'),
('601702'),
('603233'),
('600312'),
('600378'),
('600216'),
('603986'),
('603699'),
('603733'),
('601615'),
('600329'),
('600211'),
('603556'),
('600273'),
('603596'),
('600563'),
('603019'),
('601136'),
('600916'),
('600482'),
('600933'),
('600835'),
('600373'),
('600893'),
('600529'),
('601083'),
('603368'),
('600739'),
('600499'),
('601990'),
('600757'),
('603179'),
('600143'),
('601965'),
('600702'),
('603619'),
('601369'),
('603279'),
('601696'),
('603444'),
('603299'),
('603194'),
('601033'),
('600388'),
('600861'),
('600580'),
('600750'),
('603456'),
('603883'),
('600508'),
('603730'),
('603515'),
('603337'),
('603055'),
('600848'),
('600587'),
('603486'),
('601126'),
('603786'),
('600618'),
('603227'),
('603995'),
('600961'),
('605589'),
('605507'),
('603599'),
('600285'),
('601869'),
('600879'),
('603379'),
('603100'),
('600559'),
('605599'),
('600894'),
('600129'),
('600301'),
('603071'),
('600694'),
('601900'),
('603056'),
('600456'),
('600895'),
('603218'),
('601200'),
('600480'),
('600763'),
('603235'),
('603025'),
('603713'),
('601311'),
('603300'),
('603920'),
('600475'),
('601698'),
('603277'),
('603283'),
('600633'),
('603868'),
('600993'),
('603281'),
('601952'),
('605368'),
('603043'),
('600056'),
('600570'),
('600459'),
('603929'),
('603650'),
('603517'),
('605333'),
('600648'),
('603317'),
('603341'),
('600859'),
('603693'),
('603290'),
('600452'),
('603053'),
('600927'),
('600745'),
('603162'),
('603737'),
('605377'),
('600111'),
('601022'),
('601882'),
('601089'),
('600742'),
('603367'),
('603567'),
('603408'),
('601456'),
('605099'),
('600498'),
('600639'),
('600422'),
('603035'),
('605183'),
('603008'),
('603013'),
('600897'),
('600562'),
('603328'),
('603067'),
('600967'),
('603611'),
('603093'),
('600038'),
('600557'),
('601065'),
('603236'),
('603893'),
('603027'),
('603132'),
('603057'),
('600789'),
('600839'),
('603112'),
('600363'),
('603919'),
('605111'),
('603508'),
('605007'),
('603305'),
('600976'),
('603855'),
('603992'),
('603357'),
('603688'),
('600783'),
('603301'),
('600846'),
('600458'),
('600621'),
('600850'),
('605555'),
('600131'),
('603230'),
('603583'),
('603680'),
('603927'),
('601028'),
('603181'),
('605116'),
('603689'),
('603638'),
('603587'),
('605365'),
('603209'),
('605196'),
('600114'),
('603187'),
('603392'),
('603801'),
('603661'),
('603558'),
('600551'),
('603193'),
('603303'),
('603167'),
('603360'),
('603886'),
('603063'),
('605319'),
('603505'),
('603165'),
('603197'),
('600703'),
('605123'),
('603809'),
('603676'),
('600197'),
('600814'),
('603983'),
('605305'),
('603158'),
('601208'),
('603091'),
('603271'),
('605166'),
('603018'),
('603229'),
('603998'),
('603308'),
('603678'),
('603600'),
('603876'),
('600101'),
('605577'),
('605088'),
('605286'),
('600133'),
('603977'),
('601858'),
('603530'),
('603237'),
('605222'),
('603365'),
('603915'),
('603173'),
('603387'),
('605050'),
('603967'),
('605167'),
('603358'),
('603989'),
('605198'),
('603306'),
('603639'),
('605098'),
('605338'),
('603439'),
('603757'),
('601890'),
('603690'),
('603662'),
('603848'),
('601177'),
('603897'),
('603708'),
('600685'),
('605077'),
('603551'),
('603105'),
('603339'),
('603005'),
('603310'),
('605016'),
('605168'),
('603867'),
('603381'),
('603970'),
('603416'),
('603170'),
('600389'),
('600449'),
('603325'),
('605011'),
('603856'),
('600479'),
('600416'),
('603309'),
('603119'),
('603948'),
('603535'),
('600283'),
('605169'),
('603507'),
('600650'),
('603203'),
('605080'),
('600315'),
('603040'),
('603207'),
('603518'),
('603275'),
('601133'),
('600602'),
('600986'),
('605337'),
('603217'),
('600182'),
('603888'),
('603950'),
('601020'),
('603201'),
('603788'),
('603083'),
('603610'),
('605339'),
('603031'),
('603213'),
('600764'),
('603050'),
('603312'),
('600833'),
('605020'),
('605060'),
('603219'),
('603759'),
('603220'),
('603319'),
('603823'),
('603153'),
('603579'),
('603391'),
('603327'),
('605369'),
('603511'),
('603890'),
('603297'),
('603380'),
('605259'),
('603344'),
('600596'),
('603124'),
('603107'),
('600059'),
('603109'),
('600645'),
('603726'),
('605158'),
('600865'),
('603080'),
('600817'),
('603285'),
('603291'),
('603239'),
('603058'),
('603758'),
('603698'),
('603267'),
('603681'),
('603096'),
('605133'),
('605028'),
('603861'),
('603966'),
('603082'),
('603706'),
('603697'),
('601116'),
('603166'),
('601238'),
('603180'),
('603010'),
('603088'),
('603896'),
('603859'),
('600523'),
('605378'),
('603102'),
('600597'),
('603171'),
('600055'),
('605118'),
('603686'),
('600206'),
('603590'),
('603351'),
('601579'),
('603648'),
('603395'),
('600552'),
('603931'),
('605580'),
('603519'),
('600576'),
('603307'),
('600785'),
('605598'),
('605128'),
('600262'),
('603004'),
('603877'),
('603150'),
('603072'),
('603566'),
('603066'),
('600113'),
('603881'),
('603577'),
('603115'),
('605189'),
('600776'),
('605008'),
('603215'),
('605277'),
('603383'),
('605266'),
('605058'),
('603155'),
('603223'),
('600605'),
('603667'),
('603628'),
('603348'),
('605056'),
('605086'),
('603161'),
('603882'),
('603205'),
('600392'),
('600513'),
('603908'),
('603231'),
('603527'),
('605389'),
('603324'),
('603898'),
('605018'),
('605162'),
('603020'),
('600955'),
('603137'),
('605155'),
('603039'),
('603373'),
('600215'),
('603136'),
('603800'),
('600882'),
('603350'),
('603738'),
('603280'),
('603829'),
('605199'),
('603190'),
('603270'),
('605108'),
('603315'),
('603787'),
('605300'),
('603266'),
('603836'),
('600573'),
('600980'),
('603282'),
('603901'),
('605287'),
('603496'),
('603926'),
('603041'),
('603663'),
('603182'),
('603192'),
('603206'),
('603258'),
('603163'),
('603098'),
('603095'),
('603607'),
('603036'),
('605288'),
('603768'),
('603633'),
('605488'),
('603238'),
('600379'),
('603396'),
('603586'),
('605089'),
('605003'),
('603366'),
('603130'),
('603683'),
('603017'),
('603073'),
('603790'),
('603070'),
('603909'),
('603538'),
('603097'),
('600218'),
('603037'),
('600081'),
('603009'),
('603933'),
('603826'),
('603506'),
('600877'),
('603798'),
('600367'),
('600830'),
('603052'),
('603320'),
('603637'),
('603000'),
('603755'),
('603033'),
('603191'),
('600391'),
('600983'),
('603629'),
('603081'),
('605100'),
('603016'),
('603976'),
('600371'),
('603677'),
('600834'),
('603516'),
('603489'),
('603311'),
('605299'),
('603938'),
('603108'),
('605151'),
('603767'),
('600345'),
('603015'),
('603200'),
('603214'),
('603090'),
('603728'),
('605180'),
('603089'),
('605258'),
('605399'),
('600822'),
('605177'),
('603061'),
('603949'),
('605336'),
('603289'),
('605033'),
('603353'),
('603211'),
('603059'),
('603045'),
('603269'),
('603216'),
('603739'),
('603076'),
('603029'),
('601777'),
('600250'),
('603500'),
('600560'),
('603048'),
('603928'),
('600128'),
('605208'),
('603700'),
('603038'),
('600272'),
('603276'),
('605566'),
('603960'),
('603499'),
('603329'),
('605186'),
('605218'),
('600444'),
('603578'),
('600838'),
('600810'),
('603273'),
('603322'),
('605398'),
('600714'),
('600158'),
('600455'),
('600419'),
('603331'),
('603696'),
('600230'),
('603602'),
('603656'),
('603172'),
('603719'),
('603655'),
('603375'),
('605255'),
('603159'),
('603711'),
('605228'),
('600097'),
('603032'),
('600137'),
('603701'),
('600316'),
('603118'),
('603110'),
('605298'),
('600099'),
('603912'),
('605068'),
('605588'),
('600769'),
('603026'),
('603255'),
('603585'),
('603011'),
('600053'),
('603178'),
('603135'),
('603703'),
('603860'),
('603657'),
('600692'),
('603917'),
('600184'),
('002080'),
('600668'),
('000715'),
('603811'),
('002299'),
('603815'),
('603078'),
('002267'),
('001299'),
('601330'),
('600415'),
('002863'),
('002690'),
('300749'),
('603006'),
('300650'),
('603151'),
('002206'),
('600176'),
('002420'),
('605005'),
('603062'),
('002658'),
('301395'),
('300199'),
('603075'),
('301319'),
('300156'),
('300844'),
('301277'),
('300260'),
('002900'),
('002667'),
('001212'),
('600353'),
('001332'),
('000859'),
('301092'),
('300797'),
('301118'),
('002639'),
('300834'),
('603630'),
('600746'),
('605009'),
('600644'),
('300398'),
('000963'),
('002318'),
('002838'),
('600619'),
('603125'),
('300702'),
('002967'),
('000733'),
('000045');



INSERT INTO stock_codes (code) VALUES ('000501') RETURNING *;
INSERT INTO stock_codes (code) VALUES ('300797') RETURNING *;
INSERT INTO stock_codes (code) VALUES ('601888') RETURNING *;
INSERT INTO stock_codes (code) VALUES ('301065') RETURNING *;